<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Undangan Pernikahan Desmita & Ahmad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* State awal saat splash screen aktif, semua jenis scroll dimatikan */
        body.splash-active {
            overflow: hidden;
        }
        .font-great-vibes {
            font-family: 'Great Vibes', cursive;
        }
        .bg-hero {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://placehold.co/800x1200/a89078/ffffff?text=Memuat+Foto+Sampul...');
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease-in-out;
        }
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }
        #admin-panel {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-stone-100 max-w-lg mx-auto overflow-x-hidden splash-active">

    <!-- Music Player -->
    <audio id="background-music" loop></audio>
    <button id="music-toggle" class="fixed top-5 left-4 z-[60] bg-white/70 backdrop-blur-sm p-3 rounded-full shadow-lg">
        <svg id="music-on-icon" class="text-stone-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        <svg id="music-off-icon" class="hidden text-stone-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v-2a3 3 0 0 0-5.94-.6"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
    </button>
    
    <!-- Splash Screen (FIXED ONE SCREEN) -->
    <div id="splash-screen" class="fixed inset-0 bg-hero z-50 flex flex-col items-center justify-center text-white text-center p-8 transition-opacity duration-1000 h-[100svh] overflow-hidden">
        
        <!-- Admin Panel Button -->
         <button id="open-admin-panel-btn" class="hidden absolute top-5 right-5 z-50 text-white/80 hover:text-white transition-opacity">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>

        <div class="flex flex-col items-center justify-center">
            <h2 class="text-xl font-light tracking-widest">Walimatul 'Ursy</h2>
            <h1 class="font-great-vibes text-7xl my-4">Desmita & Ahmad</h1>
            <div class="mt-4">
                <p>Kepada Yth. Bapak/Ibu/Saudara/i</p>
                <p id="guest-name" class="text-2xl font-semibold mt-2 bg-black/30 backdrop-blur-sm px-4 py-2 rounded-lg">Admin View</p>
            </div>
            
            <!-- Rotating comments with typing effect will be injected here -->
            <div id="splash-comments" class="mt-8 w-full max-w-md min-h-[48px] flex items-center justify-center px-4">
            </div>
    
            <button id="open-invitation" class="mt-8 bg-stone-700/80 hover:bg-stone-600/80 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 backdrop-blur-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block mr-2 -mt-1"><path d="M21.73 18a2.64 2.64 0 0 0-3.76 0l-1.83 1.83a2.64 2.64 0 0 1-3.76 0l-1.83-1.83a2.64 2.64 0 0 0-3.76 0l-1.83 1.83a2.64 2.64 0 0 1-3.76 0l-1.83-1.83a2.64 2.64 0 0 0-3.76 0"></path><path d="m22 12-2.17-2.17a2.64 2.64 0 0 0-3.76 0l-1.83 1.83a2.64 2.64 0 0 1-3.76 0l-1.83-1.83a2.64 2.64 0 0 0-3.76 0L2 12"></path><path d="M6.24 6.24a2.64 2.64 0 0 0 0 3.76l1.83 1.83a2.64 2.64 0 0 0 3.76 0l1.83-1.83a2.64 2.64 0 0 0 0-3.76l-1.83-1.83a2.64 2.64 0 0 0-3.76 0z"></path></svg>
                Buka Undangan
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="invisible opacity-0 fixed top-4 right-4 bg-gray-900/80 backdrop-blur-md p-3 shadow-2xl z-[60] transform -translate-y-full w-72 rounded-xl">
        <button id="close-admin-panel" class="absolute -top-2 -right-2 bg-white text-gray-800 rounded-full w-7 h-7 flex items-center justify-center shadow-lg">&times;</button>
        <h3 class="font-bold text-center text-sm mb-3 text-white">Panel Admin</h3>
        <div class="space-y-3 text-xs max-h-[70vh] overflow-y-auto pr-2">
            <!-- Generate Link Section -->
            <div>
                <label class="font-semibold text-white/90">Pesan Undangan Tamu</label>
                <div class="flex items-center space-x-2 mt-1">
                    <input type="text" id="admin-guest-name" placeholder="Nama Tamu..." class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs">
                    <button id="generate-link-btn" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-md whitespace-nowrap">Buat</button>
                </div>
                <textarea id="whatsapp-message" rows="6" class="hidden w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md mt-2 text-xs" placeholder="Pesan akan muncul di sini..."></textarea>
                <button id="copy-message-btn" class="hidden w-full bg-cyan-600 hover:bg-cyan-500 text-white mt-2 py-2 rounded-md font-bold">Salin Pesan</button>
            </div>
            
            <hr class="border-white/20">

            <!-- Settings Form -->
            <form id="settings-form">
                <input type="hidden" name="action" value="saveSettings">
                
                <!-- Cover Photo -->
                <div>
                    <label class="font-semibold text-white/90">Foto Sampul</label>
                    <div class="flex items-center space-x-2 mt-1">
                        <input type="url" name="cover_photo_url" id="cover_photo_url_input" placeholder="Belum ada URL foto" class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs" readonly>
                        <button type="button" data-target="cover_photo_url_input" class="edit-toggle-btn bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded-md whitespace-nowrap">Ganti</button>
                    </div>
                </div>

                <!-- Map Link Akad -->
                <div>
                    <label class="font-semibold text-white/90">Link Peta Akad</label>
                    <div class="flex items-center space-x-2 mt-1">
                        <input type="url" name="maps_link_akad" id="maps_link_akad_input" placeholder="Belum ada URL peta" class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs" readonly>
                        <button type="button" data-target="maps_link_akad_input" class="edit-toggle-btn bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded-md whitespace-nowrap">Ganti</button>
                    </div>
                </div>

                <!-- Map Link Resepsi -->
                <div>
                    <label class="font-semibold text-white/90">Link Peta Resepsi</label>
                    <div class="flex items-center space-x-2 mt-1">
                        <input type="url" name="maps_link_resepsi" id="maps_link_resepsi_input" placeholder="Belum ada URL peta" class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs" readonly>
                        <button type="button" data-target="maps_link_resepsi_input" class="edit-toggle-btn bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded-md whitespace-nowrap">Ganti</button>
                    </div>
                </div>
                
                <!-- Music Playlist -->
                <div>
                    <label class="font-semibold text-white/90">Playlist Lagu</label>
                    <input type="hidden" name="music_playlist" id="music_playlist_input">
                    <div id="playlist-container" class="mt-1 space-y-1">
                        <!-- Songs will be listed here -->
                        <p id="no-song-text" class="text-white/50 text-center py-2">Belum ada lagu.</p>
                    </div>
                     <!-- Form for adding a new song (initially hidden) -->
                    <div id="add-song-form" class="hidden space-y-2 mt-2 p-2 bg-white/10 rounded-md">
                        <input type="text" id="new-song-title" placeholder="Judul Lagu..." class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs">
                        <input type="url" id="new-song-url" placeholder="URL MP3 Lagu..." class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-xs">
                        <div class="flex space-x-2">
                             <button type="button" id="save-new-song-btn" class="w-full bg-green-600 hover:bg-green-500 text-white py-1 rounded-md">Simpan Lagu</button>
                             <button type="button" id="cancel-add-song-btn" class="w-full bg-gray-600 hover:bg-gray-500 text-white py-1 rounded-md">Batal</button>
                        </div>
                    </div>
                    <button type="button" id="add-song-btn" class="w-full bg-purple-600 hover:bg-purple-500 text-white mt-2 py-2 rounded-md font-bold">Tambah Lagu</button>
                </div>

                <button type="submit" id="save-settings-btn" class="w-full bg-green-600 hover:bg-green-500 text-white mt-3 py-2 rounded-md font-bold">Simpan Pengaturan</button>
            </form>
        </div>
    </div>
    
    <!-- Main Content -->
    <main id="main-content" class="opacity-0 transition-opacity duration-1000">
        <!-- Header -->
        <header class="bg-hero h-screen flex flex-col items-center justify-center text-white text-center p-4">
            <h2 data-aos="fade-down" class="text-xl tracking-widest">WE ARE GETTING MARRIED</h2>
            <h1 data-aos="zoom-in" data-aos-delay="200" class="font-great-vibes text-8xl my-4">Desmita & Ahmad</h1>
            <p data-aos="fade-up" data-aos-delay="400" class="text-xl font-semibold">28 September 2025</p>
        </header>

        <!-- Bismillah -->
        <section class="py-16 px-6 text-center bg-gradient-to-b from-stone-100 to-amber-50">
            <p data-aos="fade-up" class="italic text-stone-600">"Dan di antara tanda-tanda kekuasaan-Nya ialah Dia menciptakan untukmu isteri-isteri dari jenismu sendiri, supaya kamu cenderung dan merasa tenteram kepadanya, dan dijadikan-Nya diantaramu rasa kasih dan sayang. Sesungguhnya pada yang demikian itu benar-benar terdapat tanda-tanda bagi kaum yang berfikir."</p>
            <p data-aos="fade-up" data-aos-delay="100" class="font-semibold mt-4 text-stone-800">(QS. Ar-Rum: 21)</p>
        </section>

        <!-- Bride & Groom -->
        <section class="py-20 px-6 text-center bg-amber-50">
            <h2 data-aos="fade-up" class="font-great-vibes text-5xl text-stone-800 mb-12">Assalamu'alaikum Wr. Wb.</h2>
            <p data-aos="fade-up" class="max-w-xl mx-auto text-stone-700 mb-12">Maha suci Allah SWT yang telah menciptakan makhluk-Nya berpasang-pasangan. Dengan memohon rahmat dan ridho-Nya, kami bermaksud menyelenggarakan pernikahan putra-putri kami:</p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-12">
                <div data-aos="fade-right" class="w-full">
                    <img src="https://placehold.co/300x300/e2d6c9/333333?text=Desmita" alt="Desmita" class="w-48 h-48 rounded-full mx-auto object-cover border-4 border-white custom-shadow">
                    <h3 class="font-great-vibes text-4xl mt-6 text-stone-700">Desmita Indriani Ahmad</h3>
                    <p class="mt-2 text-stone-600">Putri dari Bapak Andri Ahmad & Ibu Sri Liyan Kutey</p>
                </div>
                <p data-aos="zoom-in" data-aos-delay="200" class="font-great-vibes text-7xl text-stone-400">&</p>
                <div data-aos="fade-left" class="w-full">
                    <img src="https://placehold.co/300x300/d1c3b6/333333?text=Ahmad" alt="Ahmad" class="w-48 h-48 rounded-full mx-auto object-cover border-4 border-white custom-shadow">
                    <h3 class="font-great-vibes text-4xl mt-6 text-stone-700">Ahmad Mopangga</h3>
                    <p class="mt-2 text-stone-600">Putra dari Bapak Ramli Mopangga & Ibu Ratna Yasin</p>
                </div>
            </div>
        </section>
        
        <!-- Save The Date -->
        <section class="py-20 px-6 bg-stone-100 text-center">
            <h2 data-aos="fade-up" class="font-great-vibes text-5xl text-stone-800 mb-12">Save The Date</h2>
            <div class="space-y-8 max-w-md mx-auto">
                <div data-aos="fade-up" class="bg-white p-8 rounded-2xl custom-shadow text-stone-700">
                    <h3 class="font-great-vibes text-4xl mb-4">Akad Nikah</h3>
                    <p class="font-semibold text-lg">Minggu, 28 September 2025</p>
                    <p>Pukul 10.00 WITA - Selesai</p>
                    <hr class="my-4 border-stone-200">
                    <p class="font-semibold">Lokasi:</p>
                    <p>Kediaman Mempelai Wanita<br>Jl. Imam Bonjol, 79, Kota Gorontalo</p>
                    <a id="map-link-akad" href="#" target="_blank" class="mt-6 inline-block bg-stone-700 hover:bg-stone-600 text-white font-semibold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105">Lihat Peta</a>
                </div>
                <div data-aos="fade-up" data-aos-delay="100" class="bg-white p-8 rounded-2xl custom-shadow text-stone-700">
                    <h3 class="font-great-vibes text-4xl mb-4">Resepsi Pernikahan</h3>
                    <p class="font-semibold text-lg">Minggu, 28 September 2025</p>
                    <p>Pukul 19.00 WITA - Selesai</p>
                    <hr class="my-4 border-stone-200">
                    <p class="font-semibold">Lokasi:</p>
                    <p>Kediaman Mempelai Wanita<br>Jl. Imam Bonjol, 79, Kota Gorontalo</p>
                    <a id="map-link-resepsi" href="#" target="_blank" class="mt-6 inline-block bg-stone-700 hover:bg-stone-600 text-white font-semibold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105">Lihat Peta</a>
                </div>
            </div>
            <p data-aos="fade-up" class="max-w-md mx-auto mt-12 text-stone-600">
                Merupakan suatu kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir untuk memberikan doa restu kepada kedua mempelai.
            </p>
        </section>

        <!-- Kirim Hadiah -->
        <section class="py-20 px-6 bg-amber-50 text-center">
            <h2 data-aos="fade-up" class="font-great-vibes text-5xl text-stone-800 mb-4">Kirim Hadiah</h2>
            <p data-aos="fade-up" data-aos-delay="100" class="max-w-md mx-auto text-stone-600 mb-8">Doa restu Anda merupakan karunia yang sangat berarti bagi kami. Namun jika memberi adalah ungkapan tanda kasih, Anda dapat memberi kado secara digital.</p>
            <div data-aos="zoom-in" data-aos-delay="200" class="max-w-xs mx-auto bg-white p-6 rounded-2xl custom-shadow">
                <img src="https://raw.githubusercontent.com/qisel/Desmita-Ahmad/main/ewallet.jpg" alt="E-Wallet QR Code" class="w-full rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=Gagal+Memuat+QR';">
                <div class="text-left mt-4 text-stone-700 text-sm">
                    <p class="font-semibold">Bank Mandiri</p>
                    <p>1500012345678 a/n Desmita Indriani Ahmad</p>
                    <hr class="my-2 border-stone-200">
                    <p class="font-semibold">BRI</p>
                    <p>098701234567890 a/n Ahmad Mopangga</p>
                </div>
            </div>
        </section>

        <!-- Countdown -->
        <section class="py-20 px-6 bg-hero text-white text-center">
            <h2 data-aos="fade-up" class="font-great-vibes text-5xl mb-8">Menuju Hari Bahagia</h2>
            <div id="countdown" data-aos="zoom-in" class="flex justify-center space-x-2 md:space-x-4 text-center">
                <div><div id="days" class="text-4xl font-bold bg-white/20 backdrop-blur-sm p-4 rounded-lg">00</div><div class="text-sm mt-2">Hari</div></div>
                <div><div id="hours" class="text-4xl font-bold bg-white/20 backdrop-blur-sm p-4 rounded-lg">00</div><div class="text-sm mt-2">Jam</div></div>
                <div><div id="minutes" class="text-4xl font-bold bg-white/20 backdrop-blur-sm p-4 rounded-lg">00</div><div class="text-sm mt-2">Menit</div></div>
                <div><div id="seconds" class="text-4xl font-bold bg-white/20 backdrop-blur-sm p-4 rounded-lg">00</div><div class="text-sm mt-2">Detik</div></div>
            </div>
        </section>
        
        <!-- Guestbook / Wishes -->
        <section class="py-20 px-6 bg-stone-100 text-center">
            <h2 data-aos="fade-up" class="font-great-vibes text-5xl text-stone-800 mb-12">Buku Tamu & Ucapan</h2>
            <div data-aos="fade-up" class="max-w-md mx-auto bg-white p-8 rounded-2xl custom-shadow text-left">
                <form id="guestbook-form">
                    <input type="hidden" name="action" value="saveComment">
                    <div class="mb-4">
                        <label for="name" class="block text-stone-700 font-semibold mb-2">Nama</label>
                        <input type="text" id="name" name="name" class="w-full px-4 py-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-stone-700 font-semibold mb-2">Konfirmasi Kehadiran</label>
                        <select id="attendance" name="attendance" class="w-full px-4 py-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required>
                            <option value="Insya Allah Hadir">Insya Allah Hadir</option>
                            <option value="Berhalangan">Berhalangan</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="message" class="block text-stone-700 font-semibold mb-2">Ucapan & Doa</label>
                        <textarea id="message" name="message" rows="4" class="w-full px-4 py-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" required></textarea>
                    </div>
                    <button type="submit" id="submit-button" class="w-full bg-stone-700 hover:bg-stone-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Kirim Ucapan</button>
                    <p id="form-status" class="text-center mt-4 text-sm"></p>
                </form>
            </div>
            <div id="comments-container" class="max-w-md mx-auto mt-12 text-left space-y-3">
                <p id="loading-comments" class="text-center text-stone-600 animate-pulse">Memuat komentar...</p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-12 px-6 text-center text-stone-600 bg-stone-200">
            <p class="font-great-vibes text-4xl my-6">Desmita & Ahmad</p>
            <p class="text-sm">&copy; 2025 Undangan Digital.</p>
            <hr class="my-6 border-stone-300 max-w-[100px] mx-auto">
            <p class="text-xs text-stone-500">Undangan Digital oleh <span class="font-semibold">arkandigital barakati</span></p>
        </footer>

    </main>
    
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        // --- URL SUDAH TERHUBUNG ---
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzuss5LM6cPrb7dRHV_qbM7BSnTWqTLrcK7GlQYB2bokDKUn_L2lrThbkNgWvCuv7o_/exec';
        // ------------------------------------

        document.addEventListener('DOMContentLoaded', function () {
            AOS.init({ duration: 1000, once: true });

            // Global State
            let playlist = [];
            let currentTrackIndex = 0;

            // URL & Guest Info
            const urlParams = new URLSearchParams(window.location.search);
            const isGuest = urlParams.has('to');
            let guestName = urlParams.get('to')?.replace(/_/g, " ") || "Admin View";

            // Element Selectors
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const openButton = document.getElementById('open-invitation');
            const guestNameEl = document.getElementById('guest-name');
            const nameInput = document.getElementById('name');
            
            // Admin Panel Elements
            const adminPanel = document.getElementById('admin-panel');
            const openAdminBtn = document.getElementById('open-admin-panel-btn');
            const closeAdminBtn = document.getElementById('close-admin-panel');
            const adminGuestNameInput = document.getElementById('admin-guest-name');
            const generateBtn = document.getElementById('generate-link-btn');
            const whatsappMessageTextarea = document.getElementById('whatsapp-message');
            const copyMessageBtn = document.getElementById('copy-message-btn');
            const addSongBtn = document.getElementById('add-song-btn');
            const playlistContainer = document.getElementById('playlist-container');
            const musicPlaylistInput = document.getElementById('music_playlist_input');
            const noSongText = document.getElementById('no-song-text');
            const addSongForm = document.getElementById('add-song-form');
            const saveNewSongBtn = document.getElementById('save-new-song-btn');
            const cancelAddSongBtn = document.getElementById('cancel-add-song-btn');
            const newSongTitleInput = document.getElementById('new-song-title');
            const newSongUrlInput = document.getElementById('new-song-url');


            // --- Guest vs Admin Logic ---
            guestNameEl.textContent = guestName;
            if (isGuest) {
                nameInput.value = guestName;
            } else { // Admin View
                openAdminBtn.classList.remove('hidden');
            }

            // --- Admin Panel Functions ---
            if (openAdminBtn) {
                openAdminBtn.addEventListener('click', () => {
                    adminPanel.classList.remove('invisible');
                    setTimeout(() => {
                        adminPanel.classList.remove('opacity-0', '-translate-y-full');
                    }, 10); 
                });
            }

            if (closeAdminBtn) {
                closeAdminBtn.addEventListener('click', () => {
                    adminPanel.classList.add('opacity-0', '-translate-y-full');
                    adminPanel.addEventListener('transitionend', () => adminPanel.classList.add('invisible'), { once: true });
                });
            }

            // --- Generate & Copy Link Logic ---
            function generateMessage(guest) {
                const guestForUrl = guest.replace(/ /g, "_");
                const invitationLink = `${window.location.origin}${window.location.pathname}?to=${guestForUrl}`;
                return `
Assalamu'alaikum Warahmatullahi Wabarakatuh

Tanpa mengurangi rasa hormat, kami mengundang Bapak/Ibu/Saudara/i ${guest} untuk hadir di acara pernikahan kami:

*Desmita & Ahmad*

Untuk informasi lengkap mengenai acara, silakan kunjungi tautan undangan kami:
${invitationLink}

Merupakan suatu kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir untuk memberikan doa restu.

Terima kasih.
Wassalamu'alaikum Warahmatullahi Wabarakatuh
`.trim();
            }

            if(generateBtn) {
                generateBtn.addEventListener('click', () => {
                    const guest = adminGuestNameInput.value.trim();
                    if (!guest) {
                        alert('Silakan masukkan nama tamu terlebih dahulu.');
                        return;
                    }
                    whatsappMessageTextarea.value = generateMessage(guest);
                    whatsappMessageTextarea.classList.remove('hidden');
                    copyMessageBtn.classList.remove('hidden');
                    copyMessageBtn.textContent = 'Salin Pesan';
                });
            }
            
            if(whatsappMessageTextarea) {
                whatsappMessageTextarea.addEventListener('input', () => {
                    copyMessageBtn.textContent = 'Salin Perubahan';
                });
            }

            if(copyMessageBtn) {
                copyMessageBtn.addEventListener('click', () => {
                    const message = whatsappMessageTextarea.value;
                    const textArea = document.createElement("textarea");
                    textArea.value = message;
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        copyMessageBtn.textContent = 'Tersalin!';
                        setTimeout(() => {
                            // Reset button text based on whether it was edited
                            const originalMessage = generateMessage(adminGuestNameInput.value.trim());
                            copyMessageBtn.textContent = (whatsappMessageTextarea.value === originalMessage) ? 'Salin Pesan' : 'Salin Perubahan';
                        }, 2000);
                    } catch (err) {
                        alert('Gagal menyalin pesan.');
                    } finally {
                        document.body.removeChild(textArea);
                    }
                });
            }
            
            // --- Settings Management ---
            document.querySelectorAll('.edit-toggle-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetInput = document.getElementById(e.target.dataset.target);
                    if (targetInput.hasAttribute('readonly')) {
                        targetInput.removeAttribute('readonly');
                        targetInput.focus();
                        targetInput.select();
                        e.target.textContent = 'OK';
                        e.target.classList.replace('bg-gray-600', 'bg-blue-600');
                        e.target.classList.replace('hover:bg-gray-500', 'hover:bg-blue-500');
                    } else {
                        targetInput.setAttribute('readonly', true);
                        e.target.textContent = 'Ganti';
                        e.target.classList.replace('bg-blue-600', 'bg-gray-600');
                        e.target.classList.replace('hover:bg-blue-500', 'hover:bg-gray-500');
                    }
                });
            });
            
            if(addSongBtn) {
                addSongBtn.addEventListener('click', () => {
                    addSongForm.classList.remove('hidden');
                    addSongBtn.classList.add('hidden');
                });
            }

            if(cancelAddSongBtn) {
                cancelAddSongBtn.addEventListener('click', () => {
                    addSongForm.classList.add('hidden');
                    addSongBtn.classList.remove('hidden');
                    newSongTitleInput.value = '';
                    newSongUrlInput.value = '';
                });
            }
            
            if(saveNewSongBtn){
                saveNewSongBtn.addEventListener('click', () => {
                    const title = newSongTitleInput.value.trim();
                    const url = newSongUrlInput.value.trim();
                    if (!title || !url) {
                        alert('Judul dan URL lagu tidak boleh kosong.');
                        return;
                    }
                    playlist.push({ title, url });
                    renderPlaylist();
                    // Reset and hide form
                    cancelAddSongBtn.click();
                });
            }
            
            function renderPlaylist() {
                if(!playlistContainer) return;
                playlistContainer.innerHTML = '';
                if (playlist.length === 0) {
                    playlistContainer.appendChild(noSongText);
                    noSongText.classList.remove('hidden');
                } else {
                    noSongText.classList.add('hidden');
                    playlist.forEach((song, index) => {
                        const songEl = document.createElement('div');
                        songEl.className = 'flex items-center justify-between bg-white/10 p-2 rounded-md';
                        songEl.innerHTML = `
                            <span class="truncate text-white/90">${song.title}</span>
                            <button type="button" data-index="${index}" class="remove-song-btn text-red-400 hover:text-red-300 font-bold text-lg">&times;</button>
                        `;
                        playlistContainer.appendChild(songEl);
                    });
                }
                musicPlaylistInput.value = JSON.stringify(playlist); // Update hidden input for form submission
            }
            
            if(playlistContainer) {
                playlistContainer.addEventListener('click', (e) => {
                    if(e.target.classList.contains('remove-song-btn')) {
                        const index = parseInt(e.target.dataset.index, 10);
                        playlist.splice(index, 1);
                        renderPlaylist();
                    }
                });
            }

            // --- Fetch All Data (Settings & Comments) from Google Sheets ---
            async function fetchAllData() {
                try {
                    if (scriptURL.includes('GANTI_DENGAN')) throw new Error('URL Google Apps Script belum diatur.');
                    const response = await fetch(scriptURL);
                    const data = await response.json();
                    if (data.error) throw new Error(data.error);

                    applySettings(data.settings || {});
                    displayComments(data.comments || []);
                    displaySplashComments(data.comments || []);
                } catch (error) {
                    console.error('Error fetching data:', error);
                    alert('Gagal memuat data undangan. \n\nDetail Error: ' + error.message);
                }
            }

            function applySettings(settings) {
                // Apply Cover Photo
                const coverUrl = settings.cover_photo_url || 'https://placehold.co/800x1200/a89078/ffffff?text=Atur+Foto+di+Admin';
                document.querySelectorAll('.bg-hero').forEach(el => {
                    el.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('${coverUrl}')`;
                });
                const coverPhotoInput = document.getElementById('cover_photo_url_input');
                if(coverPhotoInput) coverPhotoInput.value = settings.cover_photo_url || '';
                
                // Apply Map Links
                const mapLinkAkad = document.getElementById('map-link-akad');
                if(mapLinkAkad) mapLinkAkad.href = settings.maps_link_akad || '#';
                const mapLinkResepsi = document.getElementById('map-link-resepsi');
                if(mapLinkResepsi) mapLinkResepsi.href = settings.maps_link_resepsi || '#';
                const mapsLinkAkadInput = document.getElementById('maps_link_akad_input');
                if(mapsLinkAkadInput) mapsLinkAkadInput.value = settings.maps_link_akad || '';
                const mapsLinkResepsiInput = document.getElementById('maps_link_resepsi_input');
                if(mapsLinkResepsiInput) mapsLinkResepsiInput.value = settings.maps_link_resepsi || '';

                // Apply Music Playlist
                try {
                    playlist = JSON.parse(settings.music_playlist || '[]');
                } catch(e) {
                    playlist = [];
                    console.error("Gagal mem-parsing playlist dari Google Sheets.", e);
                }
                renderPlaylist();
                setupMusicPlayer();
            }

            function displayComments(comments) {
                const commentsContainer = document.getElementById('comments-container');
                if(!commentsContainer) return;
                commentsContainer.innerHTML = ''; // Clear previous content, including the loading message

                if (comments.length > 0) {
                    comments.forEach(comment => {
                        const commentDiv = document.createElement('div');
                        commentDiv.className = 'bg-white p-4 rounded-lg shadow-sm';
                        commentDiv.innerHTML = `
                            <div class="flex items-center justify-between">
                              <p class="font-semibold text-stone-800">${comment.name}</p>
                              <span class="text-xs px-2 py-1 rounded-full ${comment.attendance === 'Insya Allah Hadir' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${comment.attendance}</span>
                            </div>
                            <p class="text-stone-600 mt-2 italic">"${comment.message}"</p>
                            <p class="text-right text-xs text-stone-400 mt-3">${new Date(comment.timestamp).toLocaleString('id-ID')}</p>
                        `;
                        commentsContainer.appendChild(commentDiv);
                    });
                } else {
                   // If no comments, add the message directly
                   commentsContainer.innerHTML = '<p class="text-center text-stone-600">Jadilah yang pertama memberi ucapan!</p>';
                }
            }

            let commentInterval; 

            function typeWordsEffect(element, text, speed = 250) {
                const words = text.split(' ');
                let i = 0;
                element.textContent = '';
                element.style.borderRight = '2px solid white';
                element.style.paddingRight = '3px';

                function typing() {
                    if (i < words.length) {
                        element.textContent += words[i] + ' ';
                        i++;
                        setTimeout(typing, speed);
                    } else {
                        element.textContent = element.textContent.trim();
                        element.style.borderRight = 'none';
                        element.style.paddingRight = '0';
                    }
                }
                typing();
            }

            function displaySplashComments(comments) {
                const splashCommentsContainer = document.getElementById('splash-comments');
                if(!splashCommentsContainer) return;
                splashCommentsContainer.innerHTML = ''; 
                if (commentInterval) clearInterval(commentInterval);

                if (comments.length > 0) {
                    let currentIndex = 0;
                    const latestComments = comments.slice(0, 5);

                    const showNextComment = () => {
                        const comment = latestComments[currentIndex];
                        const name = comment.name;
                        const message = `berkomentar : "${comment.message}"`;

                        // Build elements programmatically to avoid rendering issues
                        const lineContainer = document.createElement('div');
                        lineContainer.className = 'flex items-start justify-center text-sm opacity-0 transition-opacity duration-700 ease-in-out w-full';

                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'bg-blue-600/70 text-white font-semibold px-3 py-1 rounded-full text-xs whitespace-nowrap mr-2';
                        nameSpan.textContent = `- ${name} -`;

                        const textContainer = document.createElement('div');
                        textContainer.className = 'text-white text-left ml-1';
                        textContainer.style.textShadow = '0 1px 5px rgba(0,0,0,0.8)';

                        lineContainer.appendChild(nameSpan);
                        lineContainer.appendChild(textContainer);
                        
                        splashCommentsContainer.innerHTML = ''; // Clear previous before adding new
                        splashCommentsContainer.appendChild(lineContainer);
                        
                        setTimeout(() => lineContainer.classList.remove('opacity-0'), 100);
                        
                        typeWordsEffect(textContainer, message);
                        
                        currentIndex = (currentIndex + 1) % latestComments.length;
                    };
                    
                    showNextComment();
                    commentInterval = setInterval(showNextComment, 8000); 

                } else {
                    const p = document.createElement('p');
                    p.className = 'text-white/80 italic';
                    p.textContent = 'Jadilah yang pertama memberi ucapan...';
                    splashCommentsContainer.appendChild(p);
                }
            }
            
            fetchAllData();

            // --- Event Listeners & Main Logic ---
            if(openButton) {
                openButton.addEventListener('click', () => {
                    splashScreen.style.opacity = '0';
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                        mainContent.style.opacity = '1';
                        document.body.classList.remove('splash-active'); // Izinkan vertical scroll
                        if (playlist.length > 0) {
                            const musicPlayer = document.getElementById('background-music');
                           if(musicPlayer) musicPlayer.play().catch(e => console.log("Autoplay musik dicegah."));
                        }
                        AOS.refresh();
                    }, 1000);
                });
            }
            
            // --- Music Player Logic ---
            const musicPlayer = document.getElementById('background-music');
            const musicToggle = document.getElementById('music-toggle');
            const musicOnIcon = document.getElementById('music-on-icon');
            const musicOffIcon = document.getElementById('music-off-icon');

            function setupMusicPlayer() {
                if (playlist.length > 0) {
                    if(musicToggle) musicToggle.style.display = 'flex';
                    if(musicPlayer) {
                        musicPlayer.src = playlist[currentTrackIndex].url;
                        musicPlayer.load();
                    }
                } else {
                    if(musicToggle) musicToggle.style.display = 'none';
                }
            }
            
            if (musicToggle && musicPlayer && musicOnIcon && musicOffIcon) {
                musicToggle.addEventListener('click', () => {
                    if (musicPlayer.paused) {
                        musicPlayer.play();
                        musicOnIcon.classList.remove('hidden');
                        musicOffIcon.classList.add('hidden');
                    } else {
                        musicPlayer.pause();
                        musicOnIcon.classList.add('hidden');
                        musicOffIcon.classList.remove('hidden');
                    }
                });

                musicPlayer.addEventListener('ended', () => {
                    currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                    setupMusicPlayer();
                    musicPlayer.play();
                });
            }


            // Countdown Timer
            const countDownDate = new Date("Sep 28, 2025 10:00:00").getTime();
            const countdownInterval = setInterval(() => {
                const distance = countDownDate - new Date().getTime();
                const daysEl = document.getElementById("days");
                const hoursEl = document.getElementById("hours");
                const minutesEl = document.getElementById("minutes");
                const secondsEl = document.getElementById("seconds");

                if(daysEl && hoursEl && minutesEl && secondsEl) {
                    daysEl.innerText = String(Math.floor(distance/(1000*60*60*24))).padStart(2,'0');
                    hoursEl.innerText = String(Math.floor((distance%(1000*60*60*24))/(1000*60*60))).padStart(2,'0');
                    minutesEl.innerText = String(Math.floor((distance%(1000*60*60))/(1000*60))).padStart(2,'0');
                    secondsEl.innerText = String(Math.floor((distance%(1000*60))/1000)).padStart(2,'0');
                }

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    const countdownEl = document.getElementById("countdown");
                    if(countdownEl) countdownEl.innerHTML = "<div class='text-2xl'>Acara Telah Berlangsung</div>";
                }
            }, 1000);

            // Form Submissions (Comments & Settings)
            const guestbookForm = document.getElementById('guestbook-form');
            if (guestbookForm) {
                guestbookForm.addEventListener('submit', handleFormSubmit);
            }

            const settingsForm = document.getElementById('settings-form');
            if (settingsForm) {
                settingsForm.addEventListener('submit', handleFormSubmit);
            }


            function handleFormSubmit(e) {
                e.preventDefault();
                const form = e.target;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;
                
                submitButton.disabled = true;
                submitButton.textContent = 'Menyimpan...';

                // Ensure playlist data is up-to-date before submitting settings
                if (form.id === 'settings-form') {
                    const musicPlaylistInput = document.getElementById('music_playlist_input');
                    if(musicPlaylistInput) musicPlaylistInput.value = JSON.stringify(playlist);
                }

                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === 'success') {
                            submitButton.textContent = 'Tersimpan!';
                            if (form.id === 'guestbook-form') {
                                const formStatus = document.getElementById('form-status');
                                if(formStatus) formStatus.textContent = 'Terima kasih, ucapan Anda telah tersimpan!';
                                form.reset();
                                if(isGuest) {
                                    const nameInput = document.getElementById('name');
                                    if(nameInput) nameInput.value = guestName;
                                }
                                fetchAllData();
                            } else {
                                // Reload settings to confirm changes
                                alert('Pengaturan berhasil disimpan!');
                                fetchAllData();
                            }
                        } else {
                            throw new Error(data.message || 'Unknown error');
                        }
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        alert(`Gagal menyimpan: ${error.message}`);
                    })
                    .finally(() => {
                         setTimeout(() => {
                            submitButton.disabled = false;
                            submitButton.textContent = originalButtonText;
                            if (form.id === 'guestbook-form') {
                                const formStatus = document.getElementById('form-status');
                                if(formStatus) formStatus.textContent = '';
                            }
                        }, 2000);
                    });
            }
        });
    </script>
</body>
</html>

