<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="page-title">Undangan Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* State awal saat splash screen aktif, semua jenis scroll dimatikan */
        body.splash-active {
            overflow: hidden;
            height: 100vh;
        }
        .font-great-vibes {
            font-family: 'Great Vibes', cursive;
        }
        .bg-hero {
            /* Placeholder background */
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://placehold.co/1080x1920/1c1917/ffffff?text=Cover+Photo');
            background-size: cover;
            background-position: center;
        }
        .custom-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Style untuk Tombol Musik - membuatnya terlihat lebih unik dan menonjol */
        #music-toggle-btn {
            transition: all 0.3s ease;
            transform: rotate(0deg);
        }
        #music-toggle-btn.playing {
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 splash-active">

    <!-- 1. Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-hero text-white text-center p-6 transition-opacity duration-1000 ease-out">
        <div class="space-y-4">
            <p id="splash-greeting" class="text-sm">Kepada Yth. Bapak/Ibu/Saudara/i</p>
            <h3 id="guest-display-name" class="text-xl font-semibold -mt-2"></h3>
            
            <hr class="w-16 border-white mx-auto my-4 opacity-50">
            
            <h2 id="splash-title" class="text-2xl font-semibold"></h2>
            <h1 id="splash-event-name" class="font-great-vibes text-6xl my-4"></h1>
            <p id="splash-date" class="text-lg font-medium">28 September 2025</p>

            <button id="open-invitation-btn" class="mt-8 px-6 py-3 bg-white text-stone-800 font-semibold rounded-full custom-shadow transform hover:scale-105 transition duration-300">
                <span class="inline-block align-middle mr-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.894-1.664L12 3l7.106 5.406a2 2 0 01.894 1.664V19M3 19h18M3 19a2 2 0 002 2h14a2 2 0 002-2M8 11h8"></path></svg>
                </span>
                Buka Undangan
            </button>
        </div>
    </div>

    <!-- 2. Konten Utama Undangan -->
    <main id="main-content" class="hidden">
        
        <!-- Musik Toggle Button -->
        <button id="music-toggle-btn" class="fixed bottom-4 right-4 z-40 p-3 bg-stone-800 text-white rounded-full custom-shadow shadow-lg focus:outline-none">
            <svg id="music-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 3v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4 4 0 0112 3zm4 0v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4.002 4.002 0 0116 3z"></path>
            </svg>
        </button>

        <!-- Navigasi Cepat (Fixed Sidebar) -->
        <div id="navigation-sidebar" class="fixed top-1/2 right-2 transform -translate-y-1/2 z-30 space-y-2 hidden">
            <button data-target="#bride-groom-section" class="nav-btn p-3 bg-stone-800 text-white rounded-full custom-shadow text-xs" title="Profil">üßë‚Äçü§ù‚Äçüßë</button>
            <button data-target="#save-the-date-section" class="nav-btn p-3 bg-stone-800 text-white rounded-full custom-shadow text-xs" title="Acara">üìÖ</button>
            <button data-target="#countdown-section" class="nav-btn p-3 bg-stone-800 text-white rounded-full custom-shadow text-xs" title="Waktu">‚è±Ô∏è</button>
            <button data-target="#guestbook-section" class="nav-btn p-3 bg-stone-800 text-white rounded-full custom-shadow text-xs" title="Buku Tamu">‚úçÔ∏è</button>
        </div>


        <!-- Bagian 1: Opening (Pernikahan/Khitanan) -->
        <section class="bg-hero min-h-screen flex items-center justify-center p-6 text-white text-center">
            <div data-aos="fade-up" data-aos-duration="1000" class="space-y-4">
                <p class="text-lg">THE INVITATION OF</p>
                <h1 id="main-event-name" class="font-great-vibes text-8xl md:text-9xl"></h1>
                <p id="main-event-subtitle" class="text-xl md:text-2xl font-semibold"></p>
                <p id="main-event-date" class="text-base font-medium mt-4">Minggu, 28 September 2025</p>
            </div>
        </section>

        <!-- Bagian 2: Ayat Pembuka (Hanya Wedding) -->
        <section id="bismillah-section" class="py-16 px-6 text-center">
            <div class="max-w-xl mx-auto" data-aos="fade-up">
                <h2 class="font-great-vibes text-4xl text-stone-700">Bismillaahirrahmaanirrahiim</h2>
                <p class="text-sm text-stone-500 mt-2">Maha Suci Allah yang telah menciptakan pasangan-pasangan dari semua yang Kami tumbuhkan di bumi dan dari diri mereka maupun dari apa yang tidak mereka ketahui.</p>
                <p class="text-lg font-semibold text-stone-600 mt-4">(QS. Yasin: 36)</p>
            </div>
        </section>

        <!-- Bagian 3: Profil Pengantin/Anak -->
        <section id="bride-groom-section" class="py-16 px-6 bg-white">
            <div class="max-w-4xl mx-auto text-center" data-aos="fade-up">
                <h2 class="font-great-vibes text-5xl text-stone-700 mb-2"></h2>
                <p class="text-stone-500 mb-8"></p>
                
                <div class="flex flex-col md:flex-row items-center justify-center space-y-8 md:space-y-0 md:space-x-12">
                    
                    <!-- Detail Pria / Anak Khitanan -->
                    <div id="detail-groom" class="w-full md:w-1/3 space-y-3" data-aos="fade-right" data-aos-delay="200">
                        <img id="groom-img" src="https://placehold.co/300x300/e2d6c9/333333?text=Ahmad" alt="Ahmad" class="w-40 h-40 object-cover rounded-full mx-auto custom-shadow">
                        <h3 id="groom-name" class="font-great-vibes text-4xl text-stone-800">Ahmad</h3>
                        <p id="groom-parent" class="text-sm text-stone-500">Putra dari Bapak H. Suherman & Ibu Hj. Siti Aminah</p>
                    </div>

                    <!-- Simbol '&' (Hanya Wedding) -->
                    <p id="ampersand-symbol" class="font-great-vibes text-6xl text-stone-400 hidden md:block">&</p>

                    <!-- Detail Wanita (Hanya Wedding) -->
                    <div id="detail-bride" class="w-full md:w-1/3 space-y-3" data-aos="fade-left" data-aos-delay="200">
                        <img id="bride-img" src="https://placehold.co/300x300/e2d6c9/333333?text=Desmita" alt="Desmita" class="w-40 h-40 object-cover rounded-full mx-auto custom-shadow">
                        <h3 id="bride-name" class="font-great-vibes text-4xl text-stone-800">Desmita</h3>
                        <p id="bride-parent" class="text-sm text-stone-500">Putri dari Bapak Ir. Handoko & Ibu Rina Fitri</p>
                    </div>

                </div>
            </div>
        </section>

        <!-- Bagian 4: Save The Date & Lokasi -->
        <section id="save-the-date-section" class="py-16 px-6 bg-stone-100">
            <div class="max-w-4xl mx-auto text-center" data-aos="fade-up">
                <h2 class="font-great-vibes text-5xl text-stone-700 mb-4">Save The Date</h2>
                <p class="text-stone-500 mb-12">Merupakan suatu kehormatan dan kebahagiaan bagi kami, apabila Bapak/Ibu/Saudara/i berkenan hadir dan memberikan doa restu.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Acara 1: Akad/Khitanan -->
                    <div class="bg-white p-6 rounded-lg custom-shadow" data-aos="zoom-in-up" data-aos-delay="200">
                        <h3 id="event1-title" class="text-2xl font-semibold text-stone-700">Akad Nikah</h3>
                        <p class="text-sm text-stone-500 mt-1">28 September 2025</p>
                        <hr class="my-4 w-1/4 mx-auto border-stone-300">
                        <p class="text-4xl font-bold text-stone-800">10:00 WITA</p>
                        <p class="text-sm text-stone-500 mb-4">Pukul 10.00 - Selesai</p>
                        <p id="event1-location" class="text-sm font-medium">Masjid Agung Al-Falah, Jl. Perintis Kemerdekaan No. 1</p>
                        <a id="map-link-akad" href="#" target="_blank" class="mt-4 inline-block px-4 py-2 bg-stone-700 text-white text-sm font-medium rounded-full hover:bg-stone-600 transition duration-300">
                            <span class="inline-block align-middle mr-1">üìç</span> Buka Peta
                        </a>
                    </div>
                    
                    <!-- Acara 2: Resepsi (Opsional untuk Khitanan) -->
                    <div id="resepsi-event" class="bg-white p-6 rounded-lg custom-shadow" data-aos="zoom-in-up" data-aos-delay="400">
                        <h3 id="event2-title" class="text-2xl font-semibold text-stone-700">Resepsi</h3>
                        <p class="text-sm text-stone-500 mt-1">28 September 2025</p>
                        <hr class="my-4 w-1/4 mx-auto border-stone-300">
                        <p class="text-4xl font-bold text-stone-800">19:00 WITA</p>
                        <p class="text-sm text-stone-500 mb-4">Pukul 19.00 - Selesai</p>
                        <p id="event2-location" class="text-sm font-medium">Gedung Serbaguna Kota, Jl. Protokol No. 5</p>
                        <a id="map-link-resepsi" href="#" target="_blank" class="mt-4 inline-block px-4 py-2 bg-stone-700 text-white text-sm font-medium rounded-full hover:bg-stone-600 transition duration-300">
                            <span class="inline-block align-middle mr-1">üìç</span> Buka Peta
                        </a>
                    </div>

                </div>
            </div>
        </section>

        <!-- Bagian 5: Hadiah (Kirim Hadiah) -->
        <section class="py-16 px-6 text-center">
            <div class="max-w-xl mx-auto" data-aos="fade-up">
                <h2 class="font-great-vibes text-5xl text-stone-700 mb-4">Kirim Hadiah</h2>
                <p class="text-stone-500 mb-8">Doa dan restu Anda adalah karunia yang sangat berarti. Namun, jika Anda ingin memberikan hadiah, kami menyediakan fasilitas ini:</p>
                
                <div class="space-y-4 bg-white p-6 rounded-lg custom-shadow">
                    <div id="gift-info-container" class="space-y-3">
                        <!-- Data Bank/Rekening akan diisi oleh JS dari settings -->
                        <div class="border p-4 rounded-lg">
                            <p class="text-sm font-semibold">BANK MANDIRI</p>
                            <p class="text-lg font-bold text-stone-800">1234 5678 9012 3456</p>
                            <p class="text-sm text-stone-500">a.n. Ahmad S. (Pria)</p>
                            <button onclick="copyToClipboard('1234567890123456')" class="mt-2 text-xs text-blue-600 hover:underline">Salin Nomor</button>
                        </div>
                        <div class="border p-4 rounded-lg">
                            <p class="text-sm font-semibold">BANK BCA</p>
                            <p class="text-lg font-bold text-stone-800">9876 5432 1098 7654</p>
                            <p class="text-sm text-stone-500">a.n. Desmita K. (Wanita)</p>
                            <button onclick="copyToClipboard('9876543210987654')" class="mt-2 text-xs text-blue-600 hover:underline">Salin Nomor</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bagian 6: Countdown -->
        <section id="countdown-section" class="py-16 px-6 bg-stone-700 text-white text-center">
            <div class="max-w-xl mx-auto" data-aos="fade-up">
                <h2 class="font-great-vibes text-5xl mb-4">Waktu Menuju Acara</h2>
                <p class="text-sm opacity-80 mb-8">Hitung mundur menuju hari bahagia kami.</p>
                
                <div id="countdown-timer" class="flex justify-center space-x-4">
                    <div class="bg-white/10 p-4 rounded-lg w-16 md:w-20">
                        <p id="days" class="text-3xl md:text-4xl font-bold">00</p>
                        <p class="text-xs mt-1">Hari</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg w-16 md:w-20">
                        <p id="hours" class="text-3xl md:text-4xl font-bold">00</p>
                        <p class="text-xs mt-1">Jam</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg w-16 md:w-20">
                        <p id="minutes" class="text-3xl md:text-4xl font-bold">00</p>
                        <p class="text-xs mt-1">Menit</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg w-16 md:w-20">
                        <p id="seconds" class="text-3xl md:text-4xl font-bold">00</p>
                        <p class="text-xs mt-1">Detik</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Bagian 7: Buku Tamu & Ucapan -->
        <section id="guestbook-section" class="py-16 px-6 bg-stone-100">
            <div class="max-w-xl mx-auto text-center" data-aos="fade-up">
                <h2 class="font-great-vibes text-5xl text-stone-700 mb-4">Buku Tamu</h2>
                <p class="text-stone-500 mb-8">Berikan konfirmasi kehadiran dan tuliskan ucapan terbaik Anda.</p>
                
                <!-- Formulir Buku Tamu -->
                <form id="guestbook-form" class="bg-white p-6 rounded-lg custom-shadow space-y-4 text-left">
                    <input type="hidden" name="action" value="saveComment">
                    
                    <div>
                        <label for="name" class="block text-sm font-medium text-stone-700">Nama Anda:</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full border border-stone-300 rounded-md p-2 focus:ring-stone-500 focus:border-stone-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-stone-700">Konfirmasi Kehadiran:</label>
                        <div class="mt-2 space-x-4 flex">
                            <label class="inline-flex items-center">
                                <input type="radio" name="attendance" value="Hadir" class="form-radio text-stone-600" required>
                                <span class="ml-2">Hadir</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="attendance" value="Berhalangan" class="form-radio text-stone-600">
                                <span class="ml-2">Berhalangan</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="message" class="block text-sm font-medium text-stone-700">Ucapan/Doa Terbaik:</label>
                        <textarea id="message" name="message" rows="4" required class="mt-1 block w-full border border-stone-300 rounded-md p-2 focus:ring-stone-500 focus:border-stone-500"></textarea>
                    </div>

                    <p id="form-status" class="text-sm text-red-500"></p>
                    
                    <button id="guestbook-submit-btn" type="submit" class="w-full py-3 bg-stone-800 text-white font-semibold rounded-md hover:bg-stone-700 transition duration-300">
                        Kirim Ucapan
                    </button>
                </form>

                <!-- Daftar Komentar/Ucapan -->
                <div class="mt-12 text-left">
                    <h3 class="text-2xl font-semibold text-stone-700 mb-4">Ucapan Tamu (<span id="comment-count">0</span>)</h3>
                    <div id="comments-list" class="space-y-4">
                        <!-- Komentar akan dimuat di sini oleh JS -->
                        <p class="text-stone-500 text-center" id="loading-comments-text">Memuat ucapan...</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Bagian 8: Turut Mengundang (Hanya Wedding) -->
        <section id="turut-mengundang-section" class="py-12 px-6 text-center bg-white/50">
            <div class="max-w-xl mx-auto" data-aos="fade-up">
                <h3 class="text-xl font-semibold text-stone-700 mb-3">Turut Mengundang</h3>
                <p class="text-sm text-stone-500">Segenap Keluarga Besar<br>Bapak H. Suherman (Alm.) & Ibu Hj. Siti Aminah<br>Segenap Keluarga Besar<br>Bapak Ir. Handoko & Ibu Rina Fitri</p>
            </div>
        </section>

        <!-- Bagian 9: Footer -->
        <footer class="py-8 px-6 text-center bg-stone-800 text-white">
            <h2 class="font-great-vibes text-4xl mb-2">Desmita & Ahmad</h2>
            <p id="footer-greeting" class="text-sm opacity-80">Kami yang berbahagia</p>
            <p class="text-xs opacity-60 mt-4">Powered by Tailwind CSS | Design & Development by Gemini</p>
        </footer>
    </main>
    
    <!-- 3. Panel Admin (Hidden by default) -->
    <div id="admin-panel" class="fixed inset-0 z-50 bg-stone-900 bg-opacity-95 overflow-y-auto p-6 hidden">
        <div class="max-w-xl mx-auto text-white">
            <h1 class="text-3xl font-bold mb-6">‚öôÔ∏è Admin Panel Undangan</h1>
            
            <!-- Generate Link Section -->
            <div id="generate-link-section" class="bg-stone-800 p-6 rounded-lg mb-8 custom-shadow space-y-3">
                <h2 class="text-xl font-semibold mb-4">1. Buat Link Tamu</h2>
                
                <div>
                    <label class="font-semibold text-white/90">Jenis Acara</label>
                    <select id="admin-event-type" class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-sm mt-1">
                        <option value="wedding">Pernikahan (Wedding)</option>
                        <option value="khitanan">Khitanan (Sunatan)</option>
                    </select>
                </div>
                
                <div>
                    <label for="admin-guest-name" class="font-semibold text-white/90">Nama Tamu Lengkap (Misal: Budi Santoso)</label>
                    <input type="text" id="admin-guest-name" placeholder="Masukkan nama tamu..." class="w-full px-3 py-2 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-sm mt-1">
                </div>
                
                <button id="generate-btn" class="w-full py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition duration-300">
                    Generate Link WhatsApp
                </button>
                
                <textarea id="result-message" rows="6" readonly placeholder="Pesan WhatsApp akan muncul di sini setelah di-generate..." class="w-full p-3 bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-md text-sm mt-3"></textarea>
            </div>
            
            <!-- Settings Form Section -->
            <form id="settings-form" class="bg-stone-800 p-6 rounded-lg custom-shadow space-y-4">
                <h2 class="text-xl font-semibold mb-4">2. Pengaturan Acara & Media</h2>
                <input type="hidden" name="action" value="saveSettings">

                <!-- Pengaturan Umum -->
                <h3 class="text-lg font-medium mt-6">Pengaturan Umum</h3>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">URL Foto Sampul (cover_photo_url)</span>
                    <input type="url" id="cover_photo_url_input" name="cover_photo_url" class="maps-input mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="https://contoh.com/foto.jpg">
                </label>
                
                <!-- Tanggal Acara -->
                <h3 class="text-lg font-medium mt-6">Tanggal Acara</h3>
                <p class="text-xs text-white/70">Gunakan format **Month DD, YYYY HH:MM:SS** (misal: Sep 28, 2025 10:00:00)</p>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Tanggal Wedding (wedding_date)</span>
                    <input type="text" id="wedding_date_input" name="wedding_date" class="mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="Sep 28, 2025 10:00:00">
                </label>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Tanggal Khitanan (khitanan_date)</span>
                    <input type="text" id="khitanan_date_input" name="khitanan_date" class="mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="Sep 28, 2025 10:00:00">
                </label>

                <!-- Tautan Peta -->
                <h3 class="text-lg font-medium mt-6">Tautan Peta (Google Maps Share Link)</h3>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Link Peta Akad/Pernikahan (maps_link_akad)</span>
                    <input type="url" id="maps_link_akad_input" name="maps_link_akad" class="maps-input mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="https://maps.app.goo.gl/...">
                </label>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Link Peta Resepsi/Kedua (maps_link_resepsi)</span>
                    <input type="url" id="maps_link_resepsi_input" name="maps_link_resepsi" class="maps-input mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="https://maps.app.goo.gl/...">
                </label>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Link Peta Khitanan (maps_link_khitanan)</span>
                    <input type="url" id="maps_link_khitanan_input" name="maps_link_khitanan" class="maps-input mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder="https://maps.app.goo.gl/...">
                </label>

                <!-- Musik Playlist -->
                <h3 class="text-lg font-medium mt-6">Musik Playlist</h3>
                <p class="text-xs text-white/70">Masukkan URL lagu dalam format JSON Array (misal: `["url_lagu_1.mp3", "url_lagu_2.mp3"]`)</p>
                <label class="block">
                    <span class="text-white/90 text-sm font-semibold">Playlist Lagu (music_playlist)</span>
                    <textarea id="music_playlist_input" name="music_playlist" rows="4" class="mt-1 block w-full border border-white/20 rounded-md p-2 bg-white/10 text-white placeholder-white/50" placeholder='["https://contoh.com/lagu1.mp3"]'></textarea>
                </label>
                <div class="flex space-x-2">
                    <button type="button" id="preview-music-btn" class="flex-1 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition duration-300">Preview Lagu</button>
                    <button type="submit" id="settings-submit-btn" class="flex-1 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition duration-300">Simpan Pengaturan</button>
                </div>
            </form>
            
            <button id="close-admin-btn" class="mt-6 w-full py-2 bg-stone-700 text-white font-semibold rounded-md hover:bg-stone-600 transition duration-300">Tutup Admin Panel</button>
        </div>
    </div>
    
    <!-- Audio Player (Hidden) -->
    <audio id="audio-player" preload="auto"></audio>

    <!-- Pustaka AOS -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({ once: true, offset: 50 });

            // Variabel Global
            // GANTI DENGAN URL DEPLOY GOOGLE APPS SCRIPT ANDA
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzuss5LM6cPrb7dRHV_qbM7BSnTWqTLrcK7GlQYB2bokDKUn_L2lrThbkNgWvCuv7o_/exec'; 
            
            const urlParams = new URLSearchParams(window.location.search);
            const isGuest = urlParams.has('to');
            const eventType = urlParams.get('type') || 'wedding'; // Default ke 'wedding'
            let guestName = urlParams.get('to')?.replace(/_/g, " ") || "Admin View";
            
            let currentPlaylist = [];
            let currentTrackIndex = 0;
            const audioPlayer = document.getElementById('audio-player');
            const musicToggleBtn = document.getElementById('music-toggle-btn');
            const musicIcon = document.getElementById('music-icon');
            
            // =========================================================
            // FUNGSI UTAMA UNTUK MENYESUAIKAN TAMPILAN BERDASARKAN JENIS ACARA
            // =========================================================
            function setupEventContent() {
                const splashEventName = document.getElementById('splash-event-name');
                const splashTitle = document.getElementById('splash-title');
                const mainEventName = document.getElementById('main-event-name');
                const mainEventSubtitle = document.getElementById('main-event-subtitle');
                const pageTitle = document.getElementById('page-title');
                const guestDisplayName = document.getElementById('guest-display-name');
                
                const detailGroom = document.getElementById('detail-groom');
                const detailBride = document.getElementById('detail-bride');
                const ampersandSymbol = document.getElementById('ampersand-symbol');
                
                const bismillahSection = document.getElementById('bismillah-section');
                const resepsiEvent = document.getElementById('resepsi-event');
                const event1Title = document.getElementById('event1-title');
                const event2Title = document.getElementById('event2-title');
                const turutMengundangSection = document.getElementById('turut-mengundang-section');
                const footerGreeting = document.getElementById('footer-greeting');
                
                // Set Nama Tamu
                guestDisplayName.textContent = isGuest ? guestName : "Admin View";

                if (eventType === 'khitanan') {
                    // --- KHITANAN SETUP ---
                    pageTitle.textContent = "Undangan Khitanan Ananda Bintang";
                    
                    // Splash & Main Header
                    splashTitle.textContent = "WALIMATUL KHITAN";
                    splashEventName.textContent = "Bintang Ramadhan";
                    mainEventName.textContent = "Bintang Ramadhan";
                    mainEventSubtitle.textContent = "Putra dari Bapak Ahmad & Ibu Desmita";
                    
                    // Profile Section
                    document.querySelector('#bride-groom-section h2').textContent = "Bismillaahirrahmaanirrahiim";
                    document.querySelector('#bride-groom-section p').textContent = "Dengan memohon rahmat dan ridho-Nya, kami bermaksud menyelenggarakan Walimatul Khitan putra kami:";
                    
                    // Sesuaikan Detail Anak
                    if (detailGroom) {
                        detailGroom.querySelector('h3').textContent = "Bintang Ramadhan";
                        detailGroom.querySelector('p').textContent = "Putra dari Bapak Ahmad Mopangga & Ibu Desmita";
                        // detailGroom.querySelector('img').src = "https://placehold.co/300x300/e2d6c9/333333?text=BINTANG"; // Ganti foto
                    }

                    // Sembunyikan detail Mempelai Wanita & Simbol
                    if (detailBride) detailBride.style.display = 'none';
                    if (ampersandSymbol) ampersandSymbol.style.display = 'none';
                    
                    // Sembunyikan Bismillah dan Turut Mengundang
                    if (bismillahSection) bismillahSection.style.display = 'none';
                    if (turutMengundangSection) turutMengundangSection.style.display = 'none';
                    
                    // Event Titles
                    if (event1Title) event1Title.textContent = "Acara Khitanan";
                    if (resepsiEvent) resepsiEvent.style.display = 'none';
                    
                    // Footer
                    footerGreeting.textContent = "Kami yang berbahagia (Keluarga Besar)";
                    document.querySelector('footer h2').textContent = "Keluarga Ahmad & Desmita";


                } else {
                    // --- WEDDING (DEFAULT) SETUP ---
                    pageTitle.textContent = "Undangan Pernikahan Desmita & Ahmad";

                    // Splash & Main Header
                    splashTitle.textContent = "Walimatul 'Ursy";
                    splashEventName.textContent = "Desmita & Ahmad";
                    mainEventName.textContent = "Desmita & Ahmad";
                    mainEventSubtitle.textContent = "Maha Suci Allah yang telah menciptakan pasangan-pasangan";
                    
                    // Profile Section
                    document.querySelector('#bride-groom-section h2').textContent = "The Bride & Groom";
                    document.querySelector('#bride-groom-section p').textContent = "Dengan memohon rahmat dan ridho Allah SWT, kami mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami:";

                    // Pastikan elemen wedding terlihat (jika sebelumnya disembunyikan)
                    if (detailBride) detailBride.style.display = 'block';
                    if (ampersandSymbol) ampersandSymbol.style.display = 'block';
                    if (bismillahSection) bismillahSection.style.display = 'block';
                    if (turutMengundangSection) turutMengundangSection.style.display = 'block';
                    if (resepsiEvent) resepsiEvent.style.display = 'block';

                    // Event Titles
                    if (event1Title) event1Title.textContent = "Akad Nikah";
                    if (event2Title) event2Title.textContent = "Resepsi";
                    
                    // Footer
                    footerGreeting.textContent = "Kami yang berbahagia";
                    document.querySelector('footer h2').textContent = "Desmita & Ahmad";
                }
            }

            // =========================================================
            // FUNGSI UTAMA UNTUK MENGAPLIKASIKAN PENGATURAN DARI SHEET
            // =========================================================
            function applySettings(settings) {
                // 1. Cover Photo
                const coverUrl = settings.cover_photo_url || null;
                if (coverUrl) {
                    document.querySelector('.bg-hero').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('${coverUrl}')`;
                    document.querySelector('#splash-screen').classList.remove('bg-hero');
                } else {
                    // Jika URL kosong, gunakan placeholder atau class default
                    document.querySelector('#splash-screen').classList.add('bg-hero');
                }
                
                // 2. Map Links
                let mapAkadLink = '#';
                let mapResepsiLink = '#';
                let targetDate = '';

                if (eventType === 'khitanan') {
                    // Ambil link khitanan untuk kedua tombol peta (asumsi 1 lokasi)
                    mapAkadLink = settings.maps_link_khitanan || '#';
                    mapResepsiLink = settings.maps_link_khitanan || '#';
                    targetDate = settings.khitanan_date || 'Sep 28, 2025 10:00:00';

                    document.getElementById('event1-location').textContent = settings.khitanan_location || 'Lokasi Acara Khitanan (Silakan atur di Admin Panel)';
                    document.getElementById('event2-location').textContent = settings.khitanan_location || 'Lokasi Acara Khitanan (Silakan atur di Admin Panel)';
                
                } else {
                    // Wedding
                    mapAkadLink = settings.maps_link_akad || '#';
                    mapResepsiLink = settings.maps_link_resepsi || '#';
                    targetDate = settings.wedding_date || 'Sep 28, 2025 10:00:00';
                    
                    document.getElementById('event1-location').textContent = settings.akad_location || 'Lokasi Akad Nikah (Silakan atur di Admin Panel)';
                    document.getElementById('event2-location').textContent = settings.resepsi_location || 'Lokasi Resepsi (Silakan atur di Admin Panel)';
                }
                
                document.getElementById('map-link-akad').href = mapAkadLink;
                document.getElementById('map-link-resepsi').href = mapResepsiLink;

                // 3. Countdown
                const countDownDate = new Date(targetDate).getTime();
                
                const countdownInterval = setInterval(function() {
                    const now = new Date().getTime();
                    const distance = countDownDate - now;

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    document.getElementById("days").textContent = days.toString().padStart(2, '0');
                    document.getElementById("hours").textContent = hours.toString().padStart(2, '0');
                    document.getElementById("minutes").textContent = minutes.toString().padStart(2, '0');
                    document.getElementById("seconds").textContent = seconds.toString().padStart(2, '0');

                    if (distance < 0) {
                        clearInterval(countdownInterval);
                        document.getElementById("countdown-timer").innerHTML = `<p class="text-3xl font-bold">ACARA SUDAH DIMULAI!</p>`;
                    }
                }, 1000);
                
                // 4. Music Player
                const playlistJson = settings.music_playlist || '[]';
                try {
                    currentPlaylist = JSON.parse(playlistJson);
                    if (currentPlaylist.length > 0) {
                        audioPlayer.src = currentPlaylist[currentTrackIndex];
                    }
                } catch (e) {
                    console.error("Gagal memparsing playlist musik:", e);
                    currentPlaylist = [];
                }
                
                // 5. Admin Panel Initialization (Mengisi form input dengan nilai settings)
                document.getElementById('cover_photo_url_input').value = settings.cover_photo_url || '';
                document.getElementById('wedding_date_input').value = settings.wedding_date || '';
                document.getElementById('khitanan_date_input').value = settings.khitanan_date || '';
                document.getElementById('maps_link_akad_input').value = settings.maps_link_akad || '';
                document.getElementById('maps_link_resepsi_input').value = settings.maps_link_resepsi || '';
                document.getElementById('maps_link_khitanan_input').value = settings.maps_link_khitanan || '';
                document.getElementById('music_playlist_input').value = playlistJson;
            }

            // =========================================================
            // FUNGSI UTAMA UNTUK MENAMPILKAN KOMENTAR
            // =========================================================
            function renderComments(comments) {
                const commentsList = document.getElementById('comments-list');
                const commentCount = document.getElementById('comment-count');
                const loadingText = document.getElementById('loading-comments-text');
                
                if (loadingText) loadingText.style.display = 'none';

                commentsList.innerHTML = '';
                commentCount.textContent = comments.length;
                
                if (comments.length === 0) {
                    commentsList.innerHTML = '<p class="text-stone-500 text-center">Belum ada ucapan. Jadilah yang pertama!</p>';
                    return;
                }

                comments.forEach(comment => {
                    const statusClass = comment.attendance === 'Hadir' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                    const commentEl = document.createElement('div');
                    commentEl.className = 'border-b border-stone-200 p-4 bg-white rounded-lg shadow-sm';
                    commentEl.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-semibold text-stone-800">${comment.name}</p>
                            <span class="text-xs font-medium px-2 py-1 rounded-full ${statusClass}">
                                ${comment.attendance}
                            </span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2 whitespace-pre-wrap">${comment.message}</p>
                        <p class="text-xs text-stone-400">${new Date(comment.timestamp).toLocaleString('id-ID', { dateStyle: 'medium', timeStyle: 'short' })}</p>
                    `;
                    commentsList.appendChild(commentEl);
                });
            }

            // =========================================================
            // FUNGSI FETCH DATA DARI GOOGLE APPS SCRIPT
            // =========================================================
            async function fetchAllData() {
                try {
                    const response = await fetch(scriptURL, { method: 'GET' });
                    const data = await response.json();

                    if (data.error) throw new Error(data.error);
                    
                    applySettings(data.settings);
                    renderComments(data.comments);

                } catch (error) {
                    console.error("Gagal mengambil data dari Google Sheet:", error.message);
                    if (document.getElementById('loading-comments-text')) {
                         document.getElementById('loading-comments-text').textContent = 'Gagal memuat data. Periksa script URL & ID Spreadsheet.';
                    }
                }
            }
            
            // =========================================================
            // MUSIC PLAYER LOGIC
            // =========================================================
            function playMusic() {
                if (audioPlayer.paused && currentPlaylist.length > 0) {
                    audioPlayer.play().catch(error => {
                         // Autoplay was prevented
                        console.log("Autoplay dicegah. Mainkan setelah interaksi user.");
                        musicToggleBtn.classList.remove('playing');
                    });
                    musicToggleBtn.classList.add('playing');
                    musicIcon.innerHTML = `<path d="M12 3v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4.002 4.002 0 0112 3zM16 3v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4.002 4.002 0 0116 3z"></path>`; // Music Icon
                }
            }

            function pauseMusic() {
                audioPlayer.pause();
                musicToggleBtn.classList.remove('playing');
                musicIcon.innerHTML = `<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14zm11-9l-5 3V7l5 3z"></path>`; // Pause Icon
            }
            
            function nextTrack() {
                if (currentPlaylist.length > 0) {
                    currentTrackIndex = (currentTrackIndex + 1) % currentPlaylist.length;
                    audioPlayer.src = currentPlaylist[currentTrackIndex];
                    playMusic(); // Auto-play next track
                }
            }

            // =========================================================
            // INITIALIZATION
            // =========================================================
            
            // 1. Setup Konten Berdasarkan Event Type
            setupEventContent();

            // 2. Tampilkan Admin Panel jika bukan link tamu
            if (!isGuest) {
                document.getElementById('admin-panel').classList.remove('hidden');
            } else {
                // Pre-fill guest name in guestbook form
                const nameInput = document.getElementById('name');
                if(nameInput) nameInput.value = guestName;
            }

            // 3. Ambil Data Awal
            fetchAllData();

            // =========================================================
            // EVENT LISTENERS
            // =========================================================

            // Buka Undangan (Splash Screen)
            document.getElementById('open-invitation-btn').addEventListener('click', function() {
                const splashScreen = document.getElementById('splash-screen');
                const mainContent = document.getElementById('main-content');
                const navSidebar = document.getElementById('navigation-sidebar');
                
                // Animasi fade out
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    document.body.classList.remove('splash-active');
                    splashScreen.style.display = 'none';
                    mainContent.classList.remove('hidden');
                    navSidebar.classList.remove('hidden');
                    AOS.refresh(); // Refresh AOS after content display
                    playMusic(); // Coba putar musik otomatis
                }, 1000);
            });

            // Tombol Navigasi Cepat
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Music Toggle Button
            musicToggleBtn.addEventListener('click', function() {
                if (audioPlayer.paused) {
                    playMusic();
                } else {
                    pauseMusic();
                }
            });

            // Auto-play next track when current one ends
            audioPlayer.addEventListener('ended', nextTrack);

            // Copy to Clipboard
            window.copyToClipboard = function(text) {
                // Fallback for secure context (iframe support)
                const tempInput = document.createElement('textarea');
                tempInput.value = text;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                // Ganti alert dengan pesan di UI
                musicToggleBtn.textContent = '‚úÖ Disalin!';
                setTimeout(() => {
                    musicToggleBtn.innerHTML = musicIcon.outerHTML;
                    if(musicToggleBtn.classList.contains('playing')) {
                         musicIcon.innerHTML = `<path d="M12 3v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4.002 4.002 0 0112 3zM16 3v10.55a4 4 0 01-.5-.05 4.002 4.002 0 01-3.5-3.5A4.002 4.002 0 0116 3z"></path>`;
                    } else {
                         musicIcon.innerHTML = `<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14zm11-9l-5 3V7l5 3z"></path>`; 
                    }
                }, 1500);
            }

            // =========================================================
            // ADMIN PANEL LOGIC
            // =========================================================
            
            document.getElementById('close-admin-btn')?.addEventListener('click', function() {
                document.getElementById('admin-panel').classList.add('hidden');
                document.body.classList.remove('splash-active');
            });
            
            // Generate Link Button
            const adminGuestNameInput = document.getElementById('admin-guest-name');
            const adminEventTypeInput = document.getElementById('admin-event-type');
            const generateBtn = document.getElementById('generate-btn');
            const resultMessage = document.getElementById('result-message');
            
            function generateMessage(guest) {
                const guestForUrl = guest.replace(/ /g, "_");
                const selectedType = adminEventTypeInput ? adminEventTypeInput.value : 'wedding'; 
                
                const invitationLink = `${window.location.origin}${window.location.pathname}?type=${selectedType}&to=${guestForUrl}`;
                
                let eventTitle = '';
                let eventDetails = '';
                
                if (selectedType === 'khitanan') {
                    eventTitle = 'Walimatul Khitan Ananda Bintang';
                    eventDetails = 'Untuk informasi selengkapnya mengenai lokasi dan waktu Khitanan, silakan kunjungi tautan undangan:';
                } else {
                    eventTitle = 'Pernikahan Desmita & Ahmad';
                    eventDetails = 'Untuk informasi selengkapnya mengenai lokasi dan waktu Akad & Resepsi, silakan kunjungi tautan undangan:';
                }

                return `Assalamu'alaikum Warahmatullahi Wabarakatuh\n\nTanpa mengurangi rasa hormat, kami mengundang Bapak/Ibu/Saudara/i ${guest} untuk hadir di acara ${eventTitle}.\n\n${eventDetails}\n${invitationLink}\n\nMerupakan suatu kehormatan bagi kami apabila Anda berkenan hadir. Terima kasih.\n\nWassalamu'alaikum Warahmatullahi Wabarakatuh`.trim();
            }

            generateBtn?.addEventListener('click', function() {
                const guestName = adminGuestNameInput.value.trim();
                if (guestName) {
                    const message = generateMessage(guestName);
                    resultMessage.value = message;
                    
                    // Buka WhatsApp Web/App
                    const waLink = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    window.open(waLink, '_blank');
                } else {
                    resultMessage.value = 'Mohon masukkan Nama Tamu terlebih dahulu.';
                }
            });

            // Preview Music Button
            document.getElementById('preview-music-btn')?.addEventListener('click', function() {
                const musicInput = document.getElementById('music_playlist_input').value;
                try {
                    const playlist = JSON.parse(musicInput);
                    if (playlist.length > 0) {
                        // Hentikan pemutaran yang sedang berjalan
                        audioPlayer.pause();
                        audioPlayer.src = playlist[0]; // Putar lagu pertama
                        audioPlayer.loop = false;
                        
                        audioPlayer.play().catch(e => console.error("Gagal memutar lagu preview:", e));
                        
                        alert('Memutar lagu pertama dari playlist. Tekan Simpan Pengaturan untuk menyimpan daftar lagu secara permanen.');
                    } else {
                        alert('Playlist kosong atau format tidak valid.');
                    }
                } catch (e) {
                    alert('Format JSON Playlist tidak valid. Pastikan menggunakan format: ["url1.mp3", "url2.mp3"]');
                }
            });

            // =========================================================
            // FORM SUBMISSION (Guestbook & Settings)
            // =========================================================

            function handleFormSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;
                
                submitButton.disabled = true;
                submitButton.textContent = 'Loading...';

                const formData = new FormData(form);
                
                // Tambahkan nama tamu dari URL jika ini form guestbook dan tidak diisi
                if (form.id === 'guestbook-form' && isGuest) {
                    if (!formData.get('name')) {
                         formData.set('name', guestName);
                    }
                }

                fetch(scriptURL, {
                        method: 'POST',
                        body: new URLSearchParams(formData).toString(),
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === "success") {
                            // Kosongkan form guestbook setelah berhasil
                            if (form.id === 'guestbook-form') {
                                const nameInput = document.getElementById('name');
                                form.reset();
                                // Set nama tamu kembali jika ada
                                if(isGuest && nameInput) nameInput.value = guestName;
                                // Tampilkan notifikasi
                                const formStatus = document.getElementById('form-status');
                                if(formStatus) {
                                    formStatus.textContent = '‚úÖ Ucapan berhasil dikirim!';
                                    formStatus.classList.remove('text-red-500');
                                    formStatus.classList.add('text-green-600');
                                }
                                
                                fetchAllData(); // Refresh data to show new comment
                            } else {
                                // Ganti alert dengan pesan di admin panel
                                const settingsSubmitBtn = document.getElementById('settings-submit-btn');
                                settingsSubmitBtn.textContent = '‚úÖ Berhasil Disimpan!';
                                setTimeout(() => {
                                     settingsSubmitBtn.textContent = originalButtonText;
                                }, 2000);
                                fetchAllData(); // Refresh data to show changes
                            }
                        } else {
                             const errorMessage = data.message || 'Unknown error';
                             // Tampilkan notifikasi error
                            if (form.id === 'guestbook-form') {
                                const formStatus = document.getElementById('form-status');
                                if(formStatus) {
                                    formStatus.textContent = `‚ùå Gagal menyimpan: ${errorMessage}`;
                                    formStatus.classList.remove('text-green-600');
                                    formStatus.classList.add('text-red-500');
                                }
                            } else {
                                alert(`Gagal menyimpan: ${errorMessage}`);
                            }
                            throw new Error(errorMessage);
                        }
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                    })
                    .finally(() => {
                         setTimeout(() => {
                            submitButton.disabled = false;
                            submitButton.textContent = originalButtonText;
                            if (form.id === 'guestbook-form') {
                                const formStatus = document.getElementById('form-status');
                                if(formStatus) {
                                    // Hilangkan pesan status setelah beberapa waktu
                                    setTimeout(() => formStatus.textContent = '', 5000);
                                }
                            }
                        }, 2000);
                    });
            }

            document.getElementById('guestbook-form')?.addEventListener('submit', handleFormSubmit);
            document.getElementById('settings-form')?.addEventListener('submit', handleFormSubmit);
        });
    </script>
</body>
</html>
